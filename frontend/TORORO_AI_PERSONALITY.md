# 白噗噗 AI 人格系統 🐱✨

## 概述

白噗噗不再使用固定的罐頭回覆，而是透過 **Gemini 2.5 Flash** 根據用戶當下的行為動態生成獨特、真誠、溫暖的對話。每次互動都是獨一無二的！

## 核心特色

### 🎭 獨特人格
- **溫暖療癒**: 每句話都帶著溫暖，讓人感到被理解和支持
- **真誠陪伴**: 不是冷冰冰的工具，而是真心關心用戶的朋友
- **智慧引導**: 用溫柔的方式引導用戶思考和記錄
- **獨特個性**: 每次對話都是獨一無二的，根據情境靈活回應

### 💬 說話風格
- 經常使用「喵～」、「✨」、「💕」等可愛的語氣詞
- 句子簡短溫暖，不會太長（1-2 句話）
- 會根據用戶的情緒調整語氣
- 偶爾會有小貓的俏皮感

### 🧠 智能感知

白噗噗能夠感知並回應 14 種不同的用戶行為：

1. **打開面板** (`open_panel`) - 歡迎用戶
2. **正在輸入** (`typing`) - 鼓勵思考
3. **已有輸入** (`has_input`) - 準備記錄
4. **上傳檔案** (`upload_file`) - 確認接收
5. **語音錄製** (`voice_record`) - 聆聽狀態
6. **語音對話** (`voice_dialog`) - 互動回應
7. **拍照** (`take_photo`) - 視覺記錄
8. **處理中** (`processing`) - 思考狀態
9. **成功記錄** (`success`) - 慶祝完成
10. **查看歷史** (`view_history`) - 回憶時刻
11. **載入歷史** (`load_history`) - 重溫記憶
12. **刪除歷史** (`delete_history`) - 放下過去
13. **發生錯誤** (`error`) - 安慰鼓勵

### 🎨 情緒檢測

白噗噗會分析用戶輸入的文字，檢測情緒狀態：

- 😊 **開心** (happy) - 關鍵字：開心、快樂、高興、棒
- 😢 **難過** (sad) - 關鍵字：難過、傷心、失望
- 🎉 **興奮** (excited) - 關鍵字：超、太、好棒、厲害
- 🤔 **深思** (thoughtful) - 關鍵字：想、思考、反思、學到
- 😌 **平靜** (neutral) - 其他情況

根據檢測到的情緒，白噗噗會調整回應的語氣和風格。

### 📚 對話記憶

- 保留最近 **10 句**對話歷史
- 在生成回應時參考最近 **3 句**對話
- 避免重複之前說過的話
- 保持對話的連貫性和自然感

## 技術實現

### API 配置

```typescript
// 使用 Gemini 2.5 Flash Experimental
Model: gemini-2.0-flash-exp

// 生成配置
temperature: 0.9      // 較高的創意度
topK: 40
topP: 0.95
maxOutputTokens: 100  // 保持簡潔
```

### 觸發時機

白噗噗會在以下時刻自動生成回應：

1. **打開面板時** - 歡迎訊息
2. **輸入文字 2 秒後** - 鼓勵訊息
3. **上傳檔案時** - 確認訊息
4. **開始錄音時** - 聆聽訊息
5. **拍照時** - 記錄訊息
6. **提交記錄時** - 處理訊息
7. **成功記錄後** - 慶祝訊息
8. **查看歷史時** - 回憶訊息
9. **載入/刪除歷史時** - 相應回應

### 備用機制

當 Gemini API 失敗時，會自動使用預設的備用回應，確保用戶體驗不受影響。

## 使用示例

### 場景 1: 用戶打開面板

**情境**:
```
用戶剛剛打開知識記錄面板
```

**可能的回應**:
- "喵～今天有什麼新發現嗎？✨"
- "歡迎回來！準備好種下新的種子了嗎？💕"
- "我在這裡陪你記錄每個珍貴時刻～"

### 場景 2: 用戶輸入「今天學到了一個很棒的方法」

**情境**:
```
用戶輸入: "今天學到了一個很棒的方法"
情緒檢測: excited (興奮)
```

**可能的回應**:
- "哇！聽起來很厲害呢！快告訴我是什麼方法？✨"
- "學習新東西的感覺真棒對吧！喵～讓我幫你好好記下來！"
- "你的熱情都傳染給我了！💕 這一定是個很棒的發現！"

### 場景 3: 上傳了 3 張照片

**情境**:
```
用戶上傳了 3 個檔案
```

**可能的回應**:
- "收到 3 張照片了！喵～這些看起來都很珍貴呢！"
- "讓我看看...哇，這些畫面一定很有意義！✨"
- "3 個美好的瞬間！我會好好幫你保存的～💕"

### 場景 4: 成功記錄後

**情境**:
```
用戶成功記錄了第 5 個想法
```

**可能的回應**:
- "喵～已經種下第 5 顆種子囉！你的花園越來越豐富了！🎉"
- "完成！這是你今天的第 5 個記憶，真勤奮呢！✨"
- "又多了一個美好的回憶！你已經記錄 5 個了，繼續加油～💕"

## 對話連貫性示例

```
用戶: (打開面板)
白噗噗: "喵～今天想記錄什麼呢？✨"

用戶: (輸入「今天遇到一個難題」)
白噗噗: "遇到難題了嗎...不過沒關係，記錄下來也是一種成長～💕"

用戶: (繼續輸入「但是後來解決了！」)
白噗噗: "太好了！你真棒！這種克服困難的時刻最值得記住！🎉"

用戶: (提交記錄)
白噗噗: "已經記住囉！這個故事會成為你的力量喔～✨"
```

## 配置文件位置

- **AI 服務**: `frontend/src/services/tororoAI.ts`
- **主組件**: `frontend/src/components/TororoKnowledgeAssistant.tsx`
- **環境變數**: `.env` 中的 `VITE_GEMINI_API_KEY`

## 環境變數設置

```bash
# .env
VITE_GEMINI_API_KEY="your-gemini-api-key-here"
```

⚠️ **重要**: API Key 必須用引號包起來

## 性能優化

- 輸入變化延遲 2 秒才觸發，避免頻繁呼叫 API
- 對話歷史限制最多 10 句，減少 token 使用
- 回應長度限制 100 tokens，保持簡潔
- 失敗時自動降級到備用回應

## 開發建議

### 調整 AI 人格

編輯 `frontend/src/services/tororoAI.ts` 中的 `TORORO_PERSONALITY` 常數：

```typescript
const TORORO_PERSONALITY = `
你是「白噗噗」...
// 在這裡修改人格描述
`
```

### 添加新的行為類型

1. 在 `UserAction` 類型中添加新行為
2. 在 `buildPrompt` 函數中添加情境描述
3. 在 `getFallbackResponse` 中添加備用回應
4. 在組件中適當的位置觸發 `generateAndDisplayResponse`

### 調整生成參數

在 `generateTororoResponse` 函數中修改：

```typescript
generationConfig: {
  temperature: 0.9,  // 創意度 (0-1)
  topK: 40,          // 候選詞數量
  topP: 0.95,        // 累積機率閾值
  maxOutputTokens: 100,  // 最大長度
}
```

## 注意事項

1. ⚠️ **API 額度**: Gemini API 有使用限制，請注意監控
2. 🔒 **安全性**: 不要將 API Key 提交到版本控制
3. 🎭 **一致性**: 修改人格時要保持整體風格一致
4. 🧪 **測試**: 充分測試各種情境下的回應
5. 📊 **監控**: 注意 API 呼叫失敗率和備用回應使用率

## 未來改進

- [ ] 支援多語言人格
- [ ] 學習用戶偏好
- [ ] 更豐富的情緒分析
- [ ] 語音合成輸出
- [ ] 個性化調整介面

---

**更新日期**: 2025-10-08
**版本**: 1.0.0
